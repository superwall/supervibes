name: $projectName
options:
  createIntermediateGroups: true
  generateEmptyDirectories: true
  defaultConfig: Release
  postGenCommand: |
    # Format all Swift files with 2-space indentation
    if command -v swiftformat &> /dev/null; then
      swiftformat . --indent 2 --swiftversion $swiftVersion
    fi

configs:
  Debug: debug
  Release: release

schemes:
  $projectName:
    build:
      targets:
        $projectName: all
    run:
      config: Release
      debugEnabled: false
      gpuFrameCaptureMode: disabled
      gpuValidationMode: disabled
    profile:
      config: Release
    analyze:
      config: Release
    archive:
      config: Release

  $projectName-debug:
    build:
      targets:
        $projectName: all
    run:
      config: Debug
      debugEnabled: true
      gpuFrameCaptureMode: disabled
      gpuValidationMode: disabled
    test:
      config: Debug
      targets:
        - $projectNameTests
        - $projectNameUITests
    profile:
      config: Debug
    analyze:
      config: Debug
    archive:
      config: Debug

targets:
  $projectName:
    type: application
    platform: iOS
    deploymentTarget: "$deploymentTarget"
    sources:
      - path: $projectName
        excludes:
          - "**/*.xcodeproj"
          - "**/*.xcworkspace"
          - ".build"
          - ".swiftpm"
          - "*.playground"
    settings:
      base:
        GENERATE_INFOPLIST_FILE: YES
        MARKETING_VERSION: "$marketingVersion"
        ASSETCATALOG_COMPILER_GENERATE_ASSET_SYMBOLS: YES
        ASSETCATALOG_COMPILER_GENERATE_SWIFT_ASSET_SYMBOL_EXTENSIONS: YES 
        CURRENT_PROJECT_VERSION: "$projectVersion"
        SWIFT_VERSION: "$swiftVersion"
        IPHONEOS_DEPLOYMENT_TARGET: "$deploymentTarget"
        DEVELOPMENT_TEAM: $developmentTeam
        CODE_SIGN_STYLE: Automatic
        CODE_SIGN_IDENTITY: "Apple Development"
        PRODUCT_BUNDLE_IDENTIFIER: $bundleIdentifier
        PRODUCT_NAME: $displayName
        INFOPLIST_KEY_CFBundleDisplayName: $displayName

  $projectNameTests:
    type: bundle.unit-test
    platform: iOS
    deploymentTarget: "$deploymentTarget"
    sources:
      - path: $projectNameTests
        optional: true
    dependencies:
      - target: $projectName
    settings:
      base:
        GENERATE_INFOPLIST_FILE: YES
        PRODUCT_BUNDLE_IDENTIFIER: $bundleIdentifier.tests
        DEVELOPMENT_TEAM: $developmentTeam
        CODE_SIGN_STYLE: Automatic
        TEST_HOST: $(BUILT_PRODUCTS_DIR)/$displayName.app/$(BUNDLE_EXECUTABLE_FOLDER_PATH)/$displayName

  $projectNameUITests:
    type: bundle.ui-testing
    platform: iOS
    deploymentTarget: "$deploymentTarget"
    sources:
      - path: $projectNameUITests
        optional: true
    dependencies:
      - target: $projectName
    settings:
      GENERATE_INFOPLIST_FILE: YES
      PRODUCT_BUNDLE_IDENTIFIER: $bundleIdentifier.uitests
      TEST_TARGET_NAME: $projectName
      DEVELOPMENT_TEAM: $developmentTeam
      CODE_SIGN_STYLE: Automatic